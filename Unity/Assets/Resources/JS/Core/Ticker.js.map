{"version":3,"sources":["/Users/yomob/Documents/GitHub/AptosUnitySDK/Unity/TS/src/Core/Ticker.ts"],"sourcesContent":["import { requestAnimationFrame,cancelAnimationFrame } from './requestAnimationFrame';\n\nnamespace Game {\n    /**\n     * 轮循环执行器\n     */\n    export class Ticker {\n        private time:NodeJS.Timeout|number;\n        private _maxFps:number;\n        private maxIntervalTime:number;\n        private isPlay = true;\n        private static tempTasks:Function[];\n        public static tasks:Function[] = [];\n        constructor(maxFps:number){\n            this.maxFps = maxFps;\n        }\n        get maxFps(){\n            return this._maxFps;\n        }\n        set maxFps(val:number){\n            this._maxFps = val;\n            this.maxIntervalTime = 1000 / val;\n        }\n        start(){\n            this.isPlay = true;\n            this.time = requestAnimationFrame(this.loop.bind(this),this.maxIntervalTime);\n        }\n        stop(){\n            this.isPlay = false;\n            cancelAnimationFrame(this.time);\n        }\n        loop(deltaTime:number,performance:number){\n            if(!this.isPlay){\n                return;\n            };\n            if(deltaTime){\n                for(let i=0,len=Ticker.tasks.length; i<len; i++){\n                    const run:Function = Ticker.tasks[i];\n                    run(deltaTime,performance);\n                };\n            };\n            if(Ticker.tempTasks){                                                                   // 本轮执行完成，如果有新任，则将临时队列替换为要正式执行的任务\n                Ticker.tasks = Ticker.tempTasks;\n                Ticker.tempTasks = null;\n            };\n            this.time = requestAnimationFrame(this.loop.bind(this),this.maxIntervalTime);\n        }\n        public static add(fn:Function){\n            if(Ticker.tasks.indexOf(fn) < 0){\n                Ticker.tasks.push(fn);\n            };\n        }\n        public static remove(fn:Function){\n            const index = Ticker.tasks.indexOf(fn);\n            if(index > -1){                                                                         // 将新的执行任务临时存放起来，防止当前任务未结束前修改任务列表导致的其它问题\n                Ticker.tempTasks = [\n                    ...Ticker.tasks.slice(0,index),\n                    ...Ticker.tasks.slice(index+1)\n                ];\n            };\n        }\n    }\n}\n\nexport default Game.Ticker;"],"names":["requestAnimationFrame","cancelAnimationFrame","Game","Ticker","maxFps","_maxFps","val","maxIntervalTime","start","isPlay","time","loop","bind","stop","deltaTime","performance","i","len","tasks","length","run","tempTasks","add","fn","indexOf","push","remove","index","slice","constructor"],"mappings":"AAAA,SAASA,qBAAqB,EAACC,oBAAoB,QAAQ,0BAA0B;AAErF,IAAUC;;IACN;;KAEC,GACM,MAAMC;QAUT,IAAIC,SAAQ;YACR,OAAO,IAAI,CAACC,OAAO;QACvB;QACA,IAAID,OAAOE,GAAU,EAAC;YAClB,IAAI,CAACD,OAAO,GAAGC;YACf,IAAI,CAACC,eAAe,GAAG,OAAOD;QAClC;QACAE,QAAO;YACH,IAAI,CAACC,MAAM,GAAG,IAAI;YAClB,IAAI,CAACC,IAAI,GAAGV,sBAAsB,IAAI,CAACW,IAAI,CAACC,IAAI,CAAC,IAAI,GAAE,IAAI,CAACL,eAAe;QAC/E;QACAM,OAAM;YACF,IAAI,CAACJ,MAAM,GAAG,KAAK;YACnBR,qBAAqB,IAAI,CAACS,IAAI;QAClC;QACAC,KAAKG,SAAgB,EAACC,WAAkB,EAAC;YACrC,IAAG,CAAC,IAAI,CAACN,MAAM,EAAC;gBACZ;YACJ,CAAC;YACD,IAAGK,WAAU;gBACT,IAAI,IAAIE,IAAE,GAAEC,MAAId,OAAOe,KAAK,CAACC,MAAM,EAAEH,IAAEC,KAAKD,IAAI;oBAC5C,MAAMI,MAAejB,OAAOe,KAAK,CAACF,EAAE;oBACpCI,IAAIN,WAAUC;gBAClB;YACJ,CAAC;YACD,IAAGZ,OAAOkB,SAAS,EAAC;gBAAoE,iCAAiC;gBACrHlB,OAAOe,KAAK,GAAGf,OAAOkB,SAAS;gBAC/BlB,OAAOkB,SAAS,GAAG,IAAI;YAC3B,CAAC;YACD,IAAI,CAACX,IAAI,GAAGV,sBAAsB,IAAI,CAACW,IAAI,CAACC,IAAI,CAAC,IAAI,GAAE,IAAI,CAACL,eAAe;QAC/E;QACA,OAAce,IAAIC,EAAW,EAAC;YAC1B,IAAGpB,OAAOe,KAAK,CAACM,OAAO,CAACD,MAAM,GAAE;gBAC5BpB,OAAOe,KAAK,CAACO,IAAI,CAACF;YACtB,CAAC;QACL;QACA,OAAcG,OAAOH,EAAW,EAAC;YAC7B,MAAMI,QAAQxB,OAAOe,KAAK,CAACM,OAAO,CAACD;YACnC,IAAGI,QAAQ,CAAC,GAAE;gBAA0E,wCAAwC;gBAC5HxB,OAAOkB,SAAS,GAAG;uBACZlB,OAAOe,KAAK,CAACU,KAAK,CAAC,GAAED;uBACrBxB,OAAOe,KAAK,CAACU,KAAK,CAACD,QAAM;iBAC/B;YACL,CAAC;QACL;QA/CAE,YAAYzB,MAAa,CAAC;iBAHlBK,SAAS,IAAI;YAIjB,IAAI,CAACL,MAAM,GAAGA;QAClB;IA8CJ;IAvDaD,OAMKe,QAAmB,EAAE;SAN1Bf,SAAAA;GAJPD,SAAAA;AA8DV,eAAeA,KAAKC,MAAM,CAAC"}